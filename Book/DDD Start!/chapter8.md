# 애그리거트 트랜잭션 관리
- 트랜잭션으로 애그리거트 수정시, 동시성 문제가 발생할 수 있다.
### 애그리거트 잠금 기법
- 트랜잭션 잠금이란 동시성 문제가 발생하지 않도록 처리해주는 것을 말한다.
- 선점 잠금 (Pessimistic Lock)
  - 트랜잭션에서 애그리거트를 구할때 lock을 건다.
  - 그러면 다른 트랜잭션에서 잠금으로 인해 대기하고 lock을 건 트랜잭션이 커밋이 되면 접근 할 수 있다.
  - 데드락이 발생할 수 있다. 서로의 트랜잭션에서 lock을 건 애그리거트가 필요할 경우 데드락이 발생, lock timeout이라던지, 트랜잭션 대기시간 등을 걸어서 데드락 발생을 피할 수 있다.
  - 성능이슈 발생할 수 있다. 애그리거트의 조회도 되지 않으니 성능상에 이슈가 분명히 발생 할 수 있을 것 같다.
- 비선점 잠금 (Optimistic Lock)
  - entity에 version을 추가하고 @Version 어노테이션을 추가한다.
  - 수정 후 커밋이 일어나게 되면 version이 올라간다.
  - 조회했을 때 version과 수정후 커밋 하려 할때 version이 맞지 않으면 exception 발생한다.
  - 강제 버전 증가라고 하여 애그리거트가 수정되진 않았지만, 애그리거트와 연관된 entity가 수정될 경우, version이 증가하지 않게 되므로 조회 하는 것만으로도 version을 증가하게 하는 방법이 있다.
